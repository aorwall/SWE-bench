FROM python:3.11-slim

RUN apt-get update && \
    apt-get install -y --no-install-recommends gcc libgfortran5 bash git jq wget g++ make libffi-dev build-essential && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Upgrade pip and setuptools
RUN pip install --upgrade pip setuptools wheel
RUN pip install cython

# Matplotlib dependencies
RUN apt-get update && \
    apt-get install -y texlive texlive-latex-extra texlive-xetex dvipng ghostscript && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /testbed

RUN git clone https://github.com/swe-bench/matplotlib__matplotlib.git

WORKDIR /testbed/matplotlib__matplotlib

RUN git -c advice.detachedHead=false checkout c33557d120eefe3148ebfcf2e758ff2357966000

RUN pip install contourpy==1.1.0 cycler==0.11.0 fonttools==4.42.1 kiwisolver==1.4.5 numpy==1.25.2 packaging==23.1 pillow==10.0.0 pyparsing==3.0.9 python-dateutil==2.8.2 six==1.16.0 setuptools==68.1.2 setuptools-scm==7.1.0 typing-extensions==4.7.1 pytest

RUN python -m pip install -e .
